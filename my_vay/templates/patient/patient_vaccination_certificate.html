{% extends "html_container.html" %}
{% block page_title %}
    Patient - Impfpass
{% endblock %}

{% block page_content %}
    <!-- Navigation bar -->
    <nav class="fixed-bottom navbar-light bg-dark">
        <div class="container-fluid py-2">
            <ul class="nav nav-pills nav-fill">
                <li class="nav-item">
                    <a href="{{ url_for('patient_scan') }}">
                        <!-- Scan Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-upc-scan" viewBox="0 0 16 16">
                            <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/>
                        </svg>   
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('patient_impfwissen') }}">
                        <!-- Impfwissen Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-info-square" viewBox="0 0 16 16">
                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                        </svg>
                    </a>
                </li>
                <li class="nav-item">
                    <!-- Impfpass Icon (Aktiv) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="#349B73" class="bi bi-file-medical" viewBox="0 0 16 16">
                        <path d="M8.5 4.5a.5.5 0 0 0-1 0v.634l-.549-.317a.5.5 0 1 0-.5.866L7 6l-.549.317a.5.5 0 1 0 .5.866l.549-.317V7.5a.5.5 0 1 0 1 0v-.634l.549.317a.5.5 0 1 0 .5-.866L9 6l.549-.317a.5.5 0 1 0-.5-.866l-.549.317V4.5zM5.5 9a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 2a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5z"/>
                        <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"/>
                    </svg>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('patient_kalender') }}">   
                        <!-- Kalender Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-calendar-date" viewBox="0 0 16 16">
                            <path d="M6.445 11.688V6.354h-.633A12.6 12.6 0 0 0 4.5 7.16v.695c.375-.257.969-.62 1.258-.777h.012v4.61h.675zm1.188-1.305c.047.64.594 1.406 1.703 1.406 1.258 0 2-1.066 2-2.871 0-1.934-.781-2.668-1.953-2.668-.926 0-1.797.672-1.797 1.809 0 1.16.824 1.77 1.676 1.77.746 0 1.23-.376 1.383-.79h.027c-.004 1.316-.461 2.164-1.305 2.164-.664 0-1.008-.45-1.05-.82h-.684zm2.953-2.317c0 .696-.559 1.18-1.184 1.18-.601 0-1.144-.383-1.144-1.2 0-.823.582-1.21 1.168-1.21.633 0 1.16.398 1.16 1.23z"/>
                            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                        </svg>
                    </a>
                </li>    
                <li class="nav-item">
                    <a href="{{ url_for('patient_profil') }}">
                        <!-- Profil Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="white" class="bi bi-person-square" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm12 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1v-1c0-1-1-4-6-4s-6 3-6 4v1a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12z"/>
                        </svg>
                    </a>
                </li> 
            </ul>
        </div>
    </nav>
    
    <div class="container my-5">
        <div class="row">
            <div class="col-2"> </div>
            <div class="col-8">
                 <div class="row hintergrund">
                     <div class="col mt-2 text-start">
                        <!-- downloead icon, has no funtion yet so it's not displayed  -->
                       <!-- <a href=""><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#349B73" class="bi bi-upload" viewBox="0 0 16 16" >
                        <path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/>
                        <path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/>
                    </svg></a>
                     -->
                    </div>
                    <div class="col mt-1">
                        <h1 >Mein Impfpass</h1>
                    </div>
                    <div class="col mt-2 text-end">
                        <!-- shows new vaccination entry (plus) icon  -->
                        <a href="{{ url_for('patient_vaccination_entry') }}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#349B73" class="bi bi-plus-square-fill" viewBox="0 0 16 16" >
                                <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm6.5 4.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3a.5.5 0 0 1 1 0z"/>
                            </svg>
                        </a>
                    </div>
                </div>
        
                <div class="content-section">
                    <!-- shown if a vaccination notification is needed -->
                    {%if vac_notifications%}
                        {%for vac_notification in vac_notifications%}
                            <div class="card my-2" style="border: 1px solid rgb(151, 151, 151);">
                                <div class="row mt-2 mx-2">
                                    <div class="col-1 align-self-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="rgb(223, 71, 89)" class="bi bi-bell-fill" viewBox="0 0 16 16">
                                            <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2zm.995-14.901a1 1 0 1 0-1.99 0A5.002 5.002 0 0 0 3 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z"/>
                                        </svg>
                                    </div>
                                    <div class="col-11">
                                        <h5 style="color: rgb(223, 71, 89);">Empfohlene Impfung f√§llig</h5>
                                        <p style="color: rgb(151, 151, 151);">Sie wurden am {{ vac_notification.current_date_of_vaccination }} gegen {{ vac_notification.disease }} geimpft. Nach der Empfehlung des RKI's sollten Sie sich nun erneut gegen {{ vac_notification.disease }} ({{ vac_notification.next_vaccine_category }}) impfen lassen.</p>
                                    </div>
                                </div>
                            </div>
                        {%endfor%}
                        
                    {%endif%}
                    
                    <!-- shown if a new sideeffect can be entered  -->
                    {%if vac_sideeffects%}
                        {%for object in vac_sideeffects%}
                            <div class="card my-2" style="border: 1px solid rgb(151, 151, 151);">
                                <div class="row mt-2 mx-2">
                                    <div class="col-1 align-self-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="#349B73" class="bi bi-question-lg" viewBox="0 0 16 16">
                                            <path d="M3 4.075a.423.423 0 0 0 .43.44H4.9c.247 0 .442-.2.475-.445.159-1.17.962-2.022 2.393-2.022 1.222 0 2.342.611 2.342 2.082 0 1.132-.668 1.652-1.72 2.444-1.2.872-2.15 1.89-2.082 3.542l.005.386c.003.244.202.44.446.44h1.445c.247 0 .446-.2.446-.446v-.188c0-1.278.487-1.652 1.8-2.647 1.086-.826 2.217-1.743 2.217-3.667C12.667 1.301 10.393 0 7.903 0 5.645 0 3.17 1.053 3.001 4.075zm2.776 10.273c0 .95.758 1.652 1.8 1.652 1.085 0 1.832-.702 1.832-1.652 0-.985-.747-1.675-1.833-1.675-1.04 0-1.799.69-1.799 1.675z"/>
                                        </svg>
                                    </div>
                                    <div class="col-8">
                                        <h5 style="color: #349B73;">Impfreaktionen</h5>
                                        <p style="color: rgb(151, 151, 151);">Wie haben Sie ihre gestrige "{{object.vaccine}}"-Impfung vertragen? Dokumentieren Sie Ihre Impfnebenwirkungen, um diese anonym der Forschung bereitszustellen!</p> 
                                    </div>
                                    <div class="col-3 align-self-center ">
                                        <a class="btn btn-outline-success" href="{{ url_for('new_sideeffect', unique_certificate_identifier=object.unique_certificate_identifier) }}">Zum Formular</a>
                                    </div>
                                </div> 
                            </div>
                        {%endfor%}
                    {%endif%}
                        

                        <div class="row hintergrund">
                            <div col="col-12">
                                <div class="row py-3">
                                    <div class="col-6 align-self-center">
                                        <form method="POST" action="">
                                            <!-- The hidden_tag() method includes a csrf(cross-side-request-...)-token, which protects with the secrect_key the application -->
                                            {{ form.hidden_tag() }}
                                
                                            <div class="row ">
                                                <div class="col-6">
                                                    <div class="form-group">
                                                        {% if form.name.errors %}
                                                            {{ form.name(class="form-control is-invalid") }}
                                                            <div class="invalid-feedback">
                                                                {% for error in form.name.errors %}
                                                                    <span>{{ error }}</span>
                                                                {% endfor %}
                                                            </div>
                                                        
                                                        <!-- shows search form -->
                                                        {% else %}
                                                            {{ form.name(class="form-control") }}
                                        
                                                        {% endif %}
                                                    </div>
                                                </div>
                                                <div class="col-6 ">
                                                    <div class="form-group">
                                                        {{ form.submit(class="btn btn-outline-success btn-block") }}
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-6 align-self-center text-end">
                                        <!-- shows drop-down-menu so the vaccinations can be filtered -->
                                        <div class="dropdown show ">
        
                                            <a class="btn btn-secondary dropdown-toggle" href="{{ url_for('patient_home', sort=sort) }}" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                              Filtern nach:
                                            </a> 
                                           
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <a class="dropdown-item" href="{{ url_for('patient_home', sort='Pneumokokken') }}">Pneumokokken</a>
                                                <a class="dropdown-item" href="{{ url_for('patient_home', sort='Hepatitis B') }}">Hepatitis B</a>
                                                <a class="dropdown-item" href="{{ url_for('patient_home', sort='COVID-19') }}">Covid-19</a>
                                            </div>
                                            <a class="btn btn-outline-success" href="{{ url_for('patient_home', sort='date') }}">Filter aufheben</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        
                        <!-- main part of the landing page                          -->
                        <h5>
                            <div class="row mt-3">
                                <div class="col-2 text-center"> <b>Datum</b></div>
                                <div class="col-2 text-center"><b>Impfstoff </b></div>
                                <div class="col-2 text-center"><b>Krankheit</b></div>
                                <div class="col-1 text-center"><b>Art</b></div>
                                <div class="col-2 text-center"><b>Chargen-Nr.</b></div>
                                <div class="col-1 text-center"><b>Issuer</b></div>
                                <div class="col-2 text-center"><b>Zertifikat</b></div>
                            </div>
                        </h5>
                        
                        <!-- shows all selected vaccination entries  -->
                        {% if branch %}     
                        {% for entry in branch.items %}
                            {%if vaccination%}
                            {%for val in vaccination%}
                            {%if val.vaccination_id == entry.vaccination_id%}

                        
                            <div class="row">                           
                                <div class="card card-vaccination mt-2 ">
                                    <div class="row my-2">
                                        <div class="col-2 align-self-center text-center ">{{ entry.date_of_vaccination}}</div>
                                        <div class="col-2 align-self-center text-center ">{{ entry.vaccine }}</div>
                                        <div class="col-2 align-self-center text-center "> {{ val.disease }}</div>
                                        <div class="col-1 align-self-center text-center "> {{ val.vaccine_category }}</div>
                                        <div class="col-2 align-self-center text-center "> {{ entry.batch_number }}</div>
                                        <div class="col-1 align-self-center text-center "> {{ entry.unique_issuer_identifier }}</div>
                                        <div class="col-2 align-self-center text-center "> 
                                            
                                            <form action="{{ url_for('open_QR', unique_certificate_identifier=entry.unique_certificate_identifier) }}" method="Post">
                                                <button class="btn" type="submit"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="#349B73" class="bi bi-upc-scan" viewBox="0 0 16 16">
                                                    <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5zM3 4.5a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7zm2 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-7zm3 0a.5.5 0 0 1 1 0v7a.5.5 0 0 1-1 0v-7z"/>
                                                </svg></button>
                                            </form>
                                        </div>    
                                    </div>
                                </div>
                            </div>
                            {%endif%}
                            {%endfor%}
                            {%endif%}

                            
                            
                             <!-- splits entries up on more than one page if more than 5 vaccinations are shown  -->
                            <div class="col 12 text-end">
                            {% endfor %}
                            {% for page_num in branch.iter_pages(left_edge=1, right_edge=1, left_current=1, right_current=2) %}
                                {% if page_num %}
                                    {% if branch.page == page_num %}
                                         <a class="btn btn-secondary mb-4 mt-2" href="{{ url_for('patient_home', page=page_num) }}">{{ page_num }}</a>
                                    {% else %}
                                        <a class="btn btn-outline-secondary mb-4 mt-2" href="{{ url_for('patient_home', page=page_num) }}">{{ page_num }}</a>
                                {% endif %}
                                {% else %}
                                ...
                                {% endif %}
                            {% endfor %}

                        {% else %}
                            {% if search %}
                                <h3>Kein Impfeintrag gefunden!</h3>
                            {% else %}
                                <h3>Diese Seite scheint leer zu sein.</h3>
                            {% endif %}
                        {% endif %}
                        </div>
                </div>
            </div>
        
                
            <div class="col-md-2">  </div>
        </div>
          
    </div>            
        
{% endblock %}
